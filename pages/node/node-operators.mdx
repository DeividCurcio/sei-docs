# Sei Node Operations Guide

This guide covers the detailed operational aspects of running a Sei node, including configuration management, maintenance procedures, and best practices for ongoing operations.

## Configuration Management

### Directory Structure

The Sei node configuration lives in `~/.sei/config/`:

```bash
~/.sei/config/
├── app.toml          # Application configuration
├── client.toml       # Client settings
├── config.toml       # Tendermint core settings
├── genesis.json      # Chain genesis file
├── node_key.json     # Node identity key
└── priv_validator_key.json  # Validator signing key (if applicable)
```

### Essential Configuration Parameters

#### Network Settings (config.toml)

```toml
[p2p]
# Your node's public IP
external_address = "your-public-ip:26656"
# Listen address for P2P connections
laddr = "tcp://0.0.0.0:26656"
# Maximum number of inbound peers
max_num_inbound_peers = 40
# Maximum number of outbound peers
max_num_outbound_peers = 20
# Rate at which packets can be sent
send_rate = 20480000
# Rate at which packets can be received
recv_rate = 20480000

[rpc]
# RPC listen address
laddr = "tcp://0.0.0.0:26657"
# Maximum number of simultaneous connections
max_open_connections = 900
# Timeout for broadcast transactions
timeout_broadcast_tx_commit = "10s"
```

#### Application Settings (app.toml)

```toml
# Minimum gas prices for transaction acceptance
minimum-gas-prices = "0.01usei"

[api]
# Enable the API server
enable = true
# Maximum number of connections
max-open-connections = 1000

[state-commit]
# Enable defines if the SeiDB should be enabled to override existing IAVL db backend.
sc-enable = true

[state-store]
# Enable state store for historical queries
ss-enable = true
# Enable

# KeepRecent defines the number of versions to keep in state store
# Setting it to 0 means keep everything (archive node)
# Default to keep the last 100,000 blocks
ss-keep-recent = 100000
```

## Database Management

### Database Types

Sei supports two database backends:

1. Sei-DB (Recommended)

   - Higher performance
   - Better resource utilization
   - Improved sync times

2. Legacy DB
   - Traditional Cosmos SDK database
   - More widely tested
   - Compatible with older tools

### Sei-DB Configuration

```toml
[state-commit]
sc-enable = true
sc-async-commit-buffer = 100
sc-keep-recent = 1
sc-snapshot-interval = 10000

[state-store]
ss-enable = true
ss-backend = "pebbledb"
ss-async-write-buffer = 100
ss-keep-recent = 100000
ss-prune-interval = 600
```

### Database Maintenance

Regular maintenance tasks:

```bash
# Check database size
du -sh ~/.sei/data/

# Compact database (if needed)
seid tendermint unsafe-reset-all --home=$HOME/.sei --keep-addr-book

# Backup database
cp -r ~/.sei/data/ ~/sei-backup-$(date +%Y%m%d)/
```

## Service Management

### Systemd Commands

```bash
# Check service status
systemctl status seid

# Start service
systemctl start seid

# Stop service
systemctl stop seid

# Restart service
systemctl restart seid

# View logs
journalctl -u seid -f
```

### Log Management

Configure log rotation to prevent disk space issues:

```bash
sudo tee /etc/logrotate.d/sei > /dev/null << EOF
/var/log/sei/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 sei sei
    sharedscripts
    postrotate
        systemctl reload seid
    endscript
}
EOF
```

## Update Procedures

### Minor Updates

For minor version updates:

```bash
# Stop service
sudo systemctl stop seid

# Update binary
cd sei-chain
git fetch --all
git checkout [new-version]
make install

# Restart service
sudo systemctl restart seid
```

### Major Updates

For major version updates or hard forks:

1. Wait for the upgrade height
2. The node will automatically halt
3. Update the binary
4. Restart the service

```bash
# After node halts
cd sei-chain
git fetch --all
git checkout [new-version]
make install
sudo systemctl restart seid
```

## Performance Optimization

### Memory Management

```bash
# /etc/sysctl.conf
vm.swappiness = 1
vm.dirty_background_ratio = 3
vm.dirty_ratio = 10
vm.dirty_expire_centisecs = 300
vm.dirty_writeback_centisecs = 100
```

### Network Stack

```bash
# /etc/sysctl.conf
net.core.somaxconn = 32768
net.core.netdev_max_backlog = 32768
net.ipv4.tcp_max_syn_backlog = 16384
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
```

### Storage Optimization

For NVMe drives:

```bash
echo "none" > /sys/block/nvme0n1/queue/scheduler
blockdev --setra 4096 /dev/nvme0n1
```

## Backup and Recovery

### Regular Backups

Implement automated backups:

```bash
#!/bin/bash
BACKUP_DIR="/backup/sei"
DATE=$(date +%Y%m%d)

# Stop service
systemctl stop seid

# Create backup
tar czf $BACKUP_DIR/sei-backup-$DATE.tar.gz ~/.sei/

# Restart service
systemctl start seid
```

### Recovery Procedure

To restore from backup:

```bash
# Stop service
systemctl stop seid

# Remove existing data
rm -rf ~/.sei/data/

# Restore from backup
tar xzf sei-backup-[date].tar.gz -C /

# Restart service
systemctl start seid
```

## Troubleshooting

### Common Issues

1. Sync Problems

   - Check disk space
   - Verify peer connections
   - Review network settings

2. Performance Issues

   - Monitor system resources
   - Check disk I/O
   - Review network traffic

3. Database Issues
   - Verify database integrity
   - Check for corruption
   - Consider resyncing if necessary

### Diagnostic Commands

```bash
# Check sync status
seid status | jq .SyncInfo

# View peer count
seid net info | jq '.n_peers'

# Check validator status
seid query staking validator $(seid keys show -a $VALIDATOR_KEY)

# View recent blocks
seid query blocks recent
```

## Security Considerations

1. Network Security

   - Use firewalls
   - Implement rate limiting
   - Monitor for attacks

2. System Security

   - Regular updates
   - Minimal installed packages
   - Secure SSH configuration

3. Key Management
   - Secure key storage
   - Regular key rotation
   - Backup procedures

For detailed security guidelines, refer to the Security Best Practices Guide.
