# Node Configuration Guide

## Database Configuration

### Sei-DB (Recommended)

```toml
[state-commit]
sc-enable = true
sc-async-commit-buffer = 100
sc-keep-recent = 1
sc-snapshot-interval = 10000

[state-store]
ss-enable = true
ss-backend = "pebbledb"
ss-async-write-buffer = 100
ss-keep-recent = 100000
ss-prune-interval = 600
```

### Legacy DB Settings

```toml
pruning = "custom"
pruning-keep-recent = "100000"
pruning-keep-every = "0"
pruning-interval = "10"

min-retain-blocks = 100000
index-events = []
iavl-cache-size = 781250
```

## Network Configuration

### P2P Settings

```toml
[p2p]
external_address = "your-public-ip:26656"
laddr = "tcp://0.0.0.0:26656"
max_num_inbound_peers = 40
max_num_outbound_peers = 20
flush_throttle_timeout = "50ms"
max_packet_msg_payload_size = 10485760
send_rate = 20480000
recv_rate = 20480000
```

### State Sync

```toml
[statesync]
enable = true
rpc_servers = "rpc1,rpc1"
trust_height = "$trustHeight"   #  should be latest height minus 10000-20000, rounded to the nearest 10000 + 1
                                #  latest height = 127500 - 20000 = 107500
                                #  trustHeight=110001
trust_hash = "trustHash"        #  trustHash=$(curl -s "https://rpc.sei-apis.com/block?height=$trustHeight" | jq -r .block_id.hash)

discovery_time = "15s"
chunk_request_timeout = "15s"
chunk_fetchers = "4"
```

## Memory Management

### System Configuration

```bash
# /etc/sysctl.conf
vm.swappiness = 1
vm.dirty_background_ratio = 3
vm.dirty_ratio = 10
vm.dirty_expire_centisecs = 300
vm.dirty_writeback_centisecs = 100
```

### Application Memory

```toml
iavl-cache-size = 781250
inter-block-cache = true

[mempool]
size = 10000
cache_size = 10000
```

## Node Types

### Archive Node

```toml
pruning = "nothing"
min-retain-blocks = 0

[state-store]
ss-keep-recent = 0

[consensus]
double_sign_check_height = 0
```

### RPC Node

```toml
minimum-gas-prices = "0.01usei"

[api]
enable = true
max-open-connections = 100

[rpc]
laddr = "tcp://0.0.0.0:26657"
cors_allowed_origins = [""]
max_open_connections = 900
timeout_broadcast_tx_commit = "10s"
```

## Performance Tuning

### Network Stack

```bash
# /etc/sysctl.conf
net.core.somaxconn = 32768
net.core.netdev_max_backlog = 32768
net.ipv4.tcp_max_syn_backlog = 16384
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
```

### Storage

```bash
# For NVMe
echo "none" > /sys/block/nvme0n1/queue/scheduler
blockdev --setra 4096 /dev/nvme0n1

# IO Scheduling
IOSchedulingClass=realtime
IOSchedulingPriority=2
```

### CPU

```bash
# /etc/systemd/system.conf
CPUAffinity=1-15

# Set governor
for i in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do
    echo "performance" > $i
done
```

## Monitoring Configuration

### Prometheus

```toml
[instrumentation]
prometheus = true
prometheus_listen_addr = ":26660"
namespace = "tendermint"
```

### Logging

```toml
log_level = "info"
log_format = "json"

[rpc]
event-log-window-size = "30s"
event-log-max-items = 0
```
