---
title: 'Join the network using StateSync'
description: 'Detailed guide for using statesync to join the network'
keywords: ['sei node', 'blockchain node', 'node configuration', 'seidb', 'node maintenance', 'system operations']
---

import { Callout } from 'nextra/components';

# Join the testnet and mainnet networks using StateSync

Follow this guide to join an existing network through statesync. To quickly stand up a fresh full node and join in the network, it's recommended to sync through state sync.

## Install Seid Binary

To stand up a sei node, the first step is to download and install seid on your machine. If you have not done so, follow the steps in [Install Seid](/evm/installing-seid).

## State Sync

State sync allows a new node to join a network by fetching a snapshot of the application state at a recent height instead of fetching and replaying all historical blocks. This can reduce the time needed to sync with the network from days to minutes.

## Clean Up

If you are not starting a node from fresh, then you need to do some backups and clean ups.

<Callout type="info">Note: This step is not needed for fresh nodes.</Callout>

Assuming your sei home directory is `$HOME/.sei`, backup `priv_validator_state.json`:

```bash
cp $HOME/.sei/data/priv_validator_state.json $HOME/priv_validator_state.json
```

backup priv_validator_key.json

```bash
cp $HOME/.sei/config/priv_validator_key.json $HOME/priv_validator_key.json
```

backup genesis.json

```bash
cp $HOME/.sei/config/genesis.json /genesis.json
rm -rf $HOME/.sei/data/\*
rm -rf $HOME/.sei/wasm
rm -rf $HOME/.sei/config/priv_validator_key.json
rm -rf $HOME/.sei/config/genesis.json
```

## Update Configurations

Set up the RPC servers for primary and secondary endpoints. You can use one of these RPC endpoints for Statesyning

- mainnet (pacific-1): `https://sei-testnet-rpc.polkachu.com:443`
- testnet (atlantic-2): `https://sei-rpc.polkachu.com:443`

Set up trust height and trust hash. Each snapshot is created at a certain block height, and best practice here is to set the trust height to be earlier than the latest snapshot block height to avoid backward verifications.

Example: set trust height and hash to be the block height 10,000 earlier

```bash
#!/bin/bash

# Prompt for the State Sync RPC Endpoint and store it in STATE_SYNC_RPC
echo -n State Sync RPC Endpoint:
read STATE_SYNC_RPC
echo

# Prompt for the State Sync Peer and store it in STATE_SYNC_PEER
echo -n State Sync Peer:
read STATE_SYNC_PEER
echo

# Create a backup directory for keys
mkdir -p $HOME/key_backup

# Backup the validator key and state files
cp $HOME/.sei/config/priv_validator_key.json $HOME/key_backup
cp $HOME/.sei/data/priv_validator_state.json $HOME/key_backup

# Create a backup directory for the entire .sei configuration
mkdir -p $HOME/.sei_backup

# Move existing config, data, and wasm directories to the backup directory
mv $HOME/.sei/config $HOME/.sei_backup
mv $HOME/.sei/data $HOME/.sei_backup
mv $HOME/.sei/wasm $HOME/.sei_backup

# Remove the data and wasm folder
cd $HOME/.sei && ls | grep -xv "cosmovisor" | xargs rm -rf

# Restore the validator key and state files from the backup
mkdir -p $HOME/.sei/config
mkdir -p $HOME/.sei/data
cp $HOME/key_backup/priv_validator_key.json $HOME/.sei/config/
cp $HOME/key_backup/priv_validator_state.json $HOME/.sei/data/

# Set up /tmp as a 12G RAM disk to allow for more than 400 state sync chunks
sudo umount -l /tmp && sudo mount -t tmpfs -o size=12G,mode=1777 overflow /tmp

# Fetch the latest block height from the State Sync RPC endpoint
LATEST_HEIGHT=$(curl -s $STATE_SYNC_RPC/block | jq -r .result.block.header.height)
# Calculate the trust height (rounded down to the nearest 100,000)
BLOCK_HEIGHT=$(( (LATEST_HEIGHT / 100000) * 100000 ))
# Fetch the block hash at the trust height
TRUST_HASH=$(curl -s "$STATE_SYNC_RPC/block?height=$BLOCK_HEIGHT" | jq -r .result.block_id.hash)

# Update the config.toml file to enable state sync with the appropriate settings
sed -i.bak -E "s|^(enable[[:space:]]+=[[:space:]]+).*$|\1true| ; \
s|^(rpc_servers[[:space:]]+=[[:space:]]+).*$|\1\"$STATE_SYNC_RPC,$STATE_SYNC_RPC\"| ; \
s|^(trust_height[[:space:]]+=[[:space:]]+).*$|\1$BLOCK_HEIGHT| ; \
s|^(trust_hash[[:space:]]+=[[:space:]]+).*$|\1\"$TRUST_HASH\"|" $HOME/.sei/config/config.toml

# Set the persistent peers in the config.toml file to the specified State Sync Peer
sed -i.bak -e "s|^persistent_peers *=.*|persistent_peers = \"$STATE_SYNC_PEER\"|" \
  $HOME/.sei/config/config.toml

# Restore previously backed up files

cp $HOME/priv_validator_state.json $HOME/.sei/data/priv_validator_state.json
cp $HOME/priv_validator_key.json $HOME/.sei/config/priv_validator_key.json
cp $HOME/genesis.json $HOME/.sei/config/genesis.json
```
